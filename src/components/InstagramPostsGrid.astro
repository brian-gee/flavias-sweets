---
import { fetchInstagramPosts } from '../utils/instagram.js';

interface Post {
  media_type: string;
  permalink: string;
  caption?: string;
  thumbnail_url?: string;
  media_url: string;
}

const numberOfPosts = 24;
const posts: Post[] = await fetchInstagramPosts(numberOfPosts);
---

<section class="mx-auto container">
  <div class="px-4 py-12 mx-auto max-w-7xl sm:px-6 md:px-12 lg:p-24">
    <h2
      class="mb-8 text-center text-4xl font-bold leading-none tracking-tighter lg:text-5xl">
      Instagram
    </h2>
    <div class="grid grid-cols-3 gap-4">
      {
        posts.map((post: Post) => (
          <div class="w-full h-0 pb-[100%] relative">
            {post.media_type === 'VIDEO' ? (
              <video
                width="100%"
                height="100%"
                src={post.media_url}
                class="rounded-lg absolute inset-0 w-full h-full object-cover"
                controls
                loop
                preload="metadata"
                poster={post.thumbnail_url || post.media_url}
                style="object-fit: cover;"
                muted
              />
            ) : (
              <img
                width="100%"
                height="100%"
                src={post.media_url}
                alt={
                  post.caption
                    ? post.caption.substring(0, 100)
                    : 'Instagram Post'
                }
                class="rounded-lg absolute inset-0 w-full h-full object-cover"
              />
            )}
          </div>
        ))
      }
    </div>
  </div>
</section>
